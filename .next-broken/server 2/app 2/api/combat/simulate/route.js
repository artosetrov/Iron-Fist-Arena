"use strict";(()=>{var e={};e.id=679,e.ids=[679],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8848:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p});var r={};a.r(r),a.d(r,{POST:()=>c});var i=a(3278),l=a(5002),s=a(4877),n=a(1309),o=a(8638);let u={warrior:{name:"Тестовый воин",class:"warrior",level:10,stats:{strength:85,agility:20,vitality:40,endurance:25,intelligence:10,wisdom:10,luck:10,charisma:10,armor:50}},rogue:{name:"Тестовый разбойник",class:"rogue",level:10,stats:{strength:50,agility:75,vitality:30,endurance:20,intelligence:10,wisdom:10,luck:40,charisma:10,armor:30}},mage:{name:"Тестовый маг",class:"mage",level:10,stats:{strength:10,agility:25,vitality:35,endurance:10,intelligence:90,wisdom:50,luck:20,charisma:10,armor:20}},tank:{name:"Тестовый танк",class:"tank",level:10,stats:{strength:35,agility:25,vitality:60,endurance:55,intelligence:10,wisdom:20,luck:10,charisma:10,armor:80}}};async function c(e){let t=await e.json().catch(()=>({})),a=t.player,r=t.opponentPreset,i=t.playerChoices??[];if(!a?.id||!a?.name||!a?.class||!a?.level)return n.NextResponse.json({error:"player.id, player.name, player.class, player.level required"},{status:400});let l=(0,o.U)({id:a.id,name:a.name,class:a.class,level:a.level,strength:a.strength??10,agility:a.agility??10,vitality:a.vitality??10,endurance:a.endurance??10,intelligence:a.intelligence??10,wisdom:a.wisdom??10,luck:a.luck??10,charisma:a.charisma??10,armor:a.armor??0}),s=r&&u[r]?u[r]:u.warrior,c=(0,o.U)({id:"enemy",name:s.name,class:s.class,level:s.level,armor:s.stats.armor??0,...s.stats}),d=(0,o.a)(l,c,i);return n.NextResponse.json(d)}let d=new i.AppRouteRouteModule({definition:{kind:l.x.APP_ROUTE,page:"/api/combat/simulate/route",pathname:"/api/combat/simulate",filename:"route",bundlePath:"app/api/combat/simulate/route"},resolvedPagePath:"/Users/artosetrov/Documents/Cursor AI/BumWars/app/api/combat/simulate/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:p,serverHooks:h}=d,y="/api/combat/simulate/route";function f(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:p})}},8638:(e,t,a)=>{a.d(t,{U:()=>H,a:()=>x});let r={warrior:[{id:"heavy_strike",name:"Heavy Strike",unlockLevel:5,type:"physical",multiplier:2,status:{chance:.15,duration:1,type:"stun"},cooldown:3},{id:"battle_cry",name:"Battle Cry",unlockLevel:10,type:"buff",multiplier:0,selfBuff:{str:.3},cooldown:6},{id:"whirlwind",name:"Whirlwind",unlockLevel:15,type:"physical",multiplier:1.5,hits:2,cooldown:4},{id:"titan_slam",name:"Titan's Slam",unlockLevel:20,type:"physical",multiplier:3.5,armorBreak:.5,cooldown:5}],rogue:[{id:"quick_strike",name:"Quick Strike",unlockLevel:5,type:"physical",multiplier:1.6,critBonus:20,cooldown:2},{id:"shadow_step",name:"Shadow Step",unlockLevel:10,type:"buff",multiplier:0,dodgeBonus:50,dodgeBonusTurns:2,cooldown:5},{id:"backstab",name:"Backstab",unlockLevel:15,type:"physical",multiplier:2.5,firstStrikeOnly:!0,cooldown:3},{id:"assassinate",name:"Assassinate",unlockLevel:20,type:"physical",multiplier:4,executeThreshold:.3,cooldown:6}],mage:[{id:"fireball",name:"Fireball",unlockLevel:5,type:"magic",multiplier:2.2,status:{chance:.18,duration:3,type:"burn"},cooldown:2},{id:"frost_nova",name:"Frost Nova",unlockLevel:10,type:"magic",multiplier:1.8,status:{chance:.25,duration:2,type:"slow"},cooldown:4},{id:"lightning_strike",name:"Lightning Strike",unlockLevel:15,type:"magic",multiplier:2.8,status:{chance:.1,duration:1,type:"stun"},cooldown:3},{id:"meteor_storm",name:"Meteor Storm",unlockLevel:20,type:"magic",multiplier:3.8,cooldown:6}],tank:[{id:"shield_bash",name:"Shield Bash",unlockLevel:5,type:"physical",multiplier:1.4,cooldown:2},{id:"iron_wall",name:"Iron Wall",unlockLevel:10,type:"buff",multiplier:0,selfBuff:{armor:.8},cooldown:6},{id:"counter_strike",name:"Counter Strike",unlockLevel:15,type:"physical",multiplier:1.2,cooldown:4},{id:"immovable_object",name:"Immovable Object",unlockLevel:20,type:"buff",multiplier:0,selfBuff:{resist:.6},cooldown:8}]},i=(e,t)=>r[e].filter(e=>e.unlockLevel<=t),l=(e,t)=>r[e].find(e=>e.id===t),s=e=>Math.max(100,10*e),n=e=>e<=0?0:Math.min(.75,e/(e+100)),o=e=>e<=0?0:Math.min(.7,e/(e+150)),u=(e,t,a=0)=>Math.min(50,Math.max(0,5+e/10+t/15+a)),c=(e,t=0)=>Math.min(2.8,1.5+e/500+t/100),d=(e,t=0)=>Math.min(40,Math.max(0,3+e/8+t)),m=(e,t=0,a=0,r=0,i=0,l=0)=>({maxHp:s(e.vitality),critChance:u(e.agility,e.luck,r),critDamageMult:c(e.strength,i),dodgeChance:d(e.agility,l),armor:t,magicResist:100*o(e.wisdom)}),p=()=>.95+.10000000000000009*Math.random(),h=e=>{let{attackerStr:t,defenderEnd:a,defenderArmor:r,skillMultiplier:i,isCrit:l,critDamageMult:s}=e;return Math.max(1,Math.floor(Math.max(1,t*i-.5*a)*(1-n(r))*(l?s:1)*p()))},y=e=>{let{attackerInt:t,defenderWis:a,spellMultiplier:r,isCrit:i,critDamageMult:l,elementMod:s=1}=e;return Math.max(1,Math.floor(Math.max(1,t*r-.4*a)*(1-o(a))*(i?l:1)*s*p()))},f=e=>100*Math.random()<e,g=e=>100*Math.random()<e,v=(e,t)=>{let a=Math.max(1,Math.floor(t));return e.currentHp=Math.max(0,e.currentHp-a),a},M=(e,t,a)=>{let r=[];e.statusEffects=e.statusEffects.filter(t=>{if(t.duration--,"bleed"===t.type&&t.duration>=0){let t=Math.max(1,Math.floor(.05*e.maxHp));e.currentHp=Math.max(0,e.currentHp-t),r.push({type:"bleed",damage:t})}if("poison"===t.type&&t.duration>=0){let t=Math.max(1,Math.floor(.03*e.maxHp));e.currentHp=Math.max(0,e.currentHp-t),r.push({type:"poison",damage:t})}if("burn"===t.type&&t.duration>=0){let t=Math.max(1,Math.floor(.04*e.maxHp));e.currentHp=Math.max(0,e.currentHp-t),r.push({type:"burn",damage:t})}if("regen"===t.type&&t.duration>=0){let t=Math.max(1,Math.floor(.05*e.maxHp));e.currentHp=Math.min(e.maxHp,e.currentHp+t),r.push({type:"regen",healed:t})}return t.duration>0}),r.length>0&&e.currentHp>0&&t.push({turn:a,actorId:e.id,targetId:e.id,action:"status_tick",statusTicks:r,message:`Эффекты: ${r.map(e=>e.damage?`-${e.damage}`:`+${e.healed}`).join(", ")}`})},k=(e,t,a,r)=>{if(100*Math.random()<r)return!1;let i=e.statusEffects.find(e=>e.type===t);return i?i.duration=Math.max(i.duration,a):e.statusEffects.push({type:t,duration:a}),!0},b=(e,t)=>Math.min(60,e/10+t/15),w=e=>e.statusEffects.some(e=>"stun"===e.type),x=(e,t,a=[])=>{let r=[],s=0,n=0,o=()=>{if(n<a.length)return a[n++];let t=i(e.class,e.level).filter(t=>(e.abilityCooldowns[t.id]??0)<=0);return t.length>0&&.5>Math.random()?t[Math.floor(Math.random()*t.length)].id:"basic"},u=(e,t,a,i)=>{let s,n;let o="basic"===a,u=1,c=0,d=0,m=0;if(o||((s=l(e.class,a))&&(e.abilityCooldowns[s.id]??0)<=0?("physical"===s.type&&(u=s.multiplier),"magic"===s.type&&(c=s.multiplier),d=s.critBonus??0,s.armorBreak&&(m=s.armorBreak),s.status&&(n=s.status),e.abilityCooldowns[s.id]=s.cooldown):u=1),g(t.derived.dodgeChance)){r.push({turn:i,actorId:e.id,targetId:t.id,action:o?"basic":a,dodge:!0,message:"УКЛОНЕНИЕ!"});return}let p=0,M=!c||0===c,w=f(Math.min(50,e.derived.critChance+d));M&&u>0?p=h({attackerStr:e.baseStats.strength,defenderEnd:t.baseStats.endurance,defenderArmor:t.armor,skillMultiplier:u,isCrit:w,critDamageMult:e.derived.critDamageMult}):c>0&&(p=y({attackerInt:e.baseStats.intelligence,defenderWis:t.baseStats.wisdom,spellMultiplier:c,isCrit:w,critDamageMult:e.derived.critDamageMult})),s?.hits&&(p*=s.hits),s?.executeThreshold&&t.currentHp/t.maxHp<s.executeThreshold&&(p=Math.floor(p*e.derived.critDamageMult));let x=v(t,p);if(r.push({turn:i,actorId:e.id,targetId:t.id,action:o?"basic":a,damage:x,crit:w,message:`${e.name} ${o?"атакует":a}: ${x} урона${w?" (крит)":""}.`}),m>0){let e=t.armor*m;t.armor=Math.max(0,Math.floor(t.armor-e)),k(t,"armor_break",2,100-b(t.baseStats.endurance,t.baseStats.wisdom))}n&&Math.random()<n.chance&&k(t,n.type,n.duration,100-b(t.baseStats.endurance,t.baseStats.wisdom))},c=e=>{for(let t of Object.keys(e.abilityCooldowns))e.abilityCooldowns[t]=Math.max(0,e.abilityCooldowns[t]-1)};for(;s<15&&e.currentHp>0&&t.currentHp>0&&(M(e,r,++s),M(t,r,s),!(e.currentHp<=0)&&!(t.currentHp<=0));){let a=e.baseStats.agility>=t.baseStats.agility,i=a?e:t,l=a?t:e;if(c(e),c(t),w(i))i.statusEffects=i.statusEffects.filter(e=>"stun"!==e.type||e.duration>1),r.push({turn:s,actorId:i.id,targetId:i.id,action:"stun",message:`${i.name} оглушён.`});else{let t=i.id===e.id?o():"basic";u(i,l,t,s)}if(l.currentHp<=0)break;if(w(l))l.statusEffects=l.statusEffects.filter(e=>"stun"!==e.type||e.duration>1),r.push({turn:s,actorId:l.id,targetId:l.id,action:"stun",message:`${l.name} оглушён.`});else{let t=l.id===e.id?o():"basic";u(l,i,t,s)}}let d=null,m=null,p=!1;if(e.currentHp<=0&&t.currentHp<=0)p=!0;else if(e.currentHp<=0)d=t.id,m=e.id;else if(t.currentHp<=0)d=e.id,m=t.id;else{let a=e.currentHp/e.maxHp,r=t.currentHp/t.maxHp;a>r?(d=e.id,m=t.id):r>a?(d=t.id,m=e.id):p=!0}return{winnerId:d,loserId:m,draw:p,turns:s,log:r}},H=e=>{let{id:t,name:a,class:r,level:i,strength:l,agility:s,vitality:n,endurance:o,intelligence:u,wisdom:c,luck:d,charisma:p,armor:h=0}=e,y={strength:l,agility:s,vitality:n,endurance:o,intelligence:u,wisdom:c,luck:d,charisma:p},f=m(y,h,0),g=f.maxHp;return{id:t,name:a,class:r,level:i,baseStats:y,derived:f,currentHp:g,maxHp:g,armor:h,magicResist:f.magicResist,statusEffects:[],abilityCooldowns:{}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[787,833],()=>a(8848));module.exports=r})();