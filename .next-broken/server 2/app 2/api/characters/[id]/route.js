"use strict";(()=>{var e={};e.id=636,e.ids=[636],e.modules={3524:e=>{e.exports=require("@prisma/client")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5200:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>U,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>S});var r={};a.r(r),a.d(r,{GET:()=>m});var n=a(3278),i=a(5002),s=a(4877),o=a(6660),u=a(1035),c=a(1309),p=a(8190);async function m(e,{params:t}){let a=await (0,o.f)(),{data:{user:r}}=await a.auth.getUser();if(!r)return c.NextResponse.json({error:"Unauthorized"},{status:401});let{id:n}=await t,i=await u._.character.findFirst({where:{id:n,userId:r.id},include:{equipment:{where:{isEquipped:!0},include:{item:!0}},user:!0}});if(!i)return c.NextResponse.json({error:"Not found"},{status:404});let s=!!i.user?.premiumUntil&&i.user.premiumUntil>new Date,{currentStamina:m,lastStaminaUpdate:l}=(0,p.bQ)({currentStamina:i.currentStamina,maxStamina:i.maxStamina,lastStaminaUpdate:i.lastStaminaUpdate,isVip:s});(m!==i.currentStamina||l.getTime()!==i.lastStaminaUpdate.getTime())&&await u._.character.update({where:{id:i.id},data:{currentStamina:m,lastStaminaUpdate:l}});let{user:d,...S}=i;return c.NextResponse.json({...S,currentStamina:m,lastStaminaUpdate:l})}let l=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/characters/[id]/route",pathname:"/api/characters/[id]",filename:"route",bundlePath:"app/api/characters/[id]/route"},resolvedPagePath:"/Users/artosetrov/Documents/Cursor AI/BumWars/app/api/characters/[id]/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:S,serverHooks:h}=l,U="/api/characters/[id]/route";function x(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:S})}},1035:(e,t,a)=>{a.d(t,{_:()=>n});var r=a(3524);let n=globalThis.prisma??new r.PrismaClient({log:["error"]})},8190:(e,t,a)=>{a.d(t,{YX:()=>o,bQ:()=>u,ou:()=>n,yv:()=>s,zU:()=>r});let r=200,n={PVP:10,DUNGEON_EASY:15,DUNGEON_NORMAL:20,DUNGEON_HARD:25,BOSS_RAID:40,SPECIAL_EVENT:30},i=e=>{let{currentStamina:t,maxStamina:a,lastStaminaUpdate:n,isVip:i}=e,s=i?a:Math.min(a,100);return t>=s?Math.min(t,r):Math.min(s,t+Math.floor((Date.now()-new Date(n).getTime())/72e4))},s=e=>{let{cost:t,isVip:a}=e,r=i({currentStamina:e.currentStamina,maxStamina:e.maxStamina,lastStaminaUpdate:e.lastStaminaUpdate,isVip:a});return r<t?{error:"Недостаточно стамины"}:{newStamina:r-t,newLastUpdate:new Date}},o=e=>e?120:100,u=e=>{let{maxStamina:t,isVip:a}=e,n=o(!!a),i=e.currentStamina,s=new Date(e.lastStaminaUpdate).getTime(),u=Date.now();return i<n&&(i=Math.min(n,i+Math.floor((u-s)/72e4))),{currentStamina:Math.min(i,r),lastStaminaUpdate:new Date(u)}}},6660:(e,t,a)=>{a.d(t,{f:()=>i});var r=a(7782),n=a(2845);let i=async()=>{let e=await (0,n.cookies)(),t=process.env.NEXT_PUBLIC_SUPABASE_URL,a=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!t||!a)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY");return(0,r.createServerClient)(t,a,{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:a,options:r})=>e.set(t,a,r))}catch{}}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[787,833,228],()=>a(5200));module.exports=r})();