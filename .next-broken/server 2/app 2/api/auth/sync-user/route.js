"use strict";(()=>{var e={};e.id=694,e.ids=[694],e.modules={3524:e=>{e.exports=require("@prisma/client")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7135:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>_,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{POST:()=>c});var s=r(3278),i=r(5002),n=r(4877),o=r(6660),u=r(1035),p=r(1309);async function c(e){let t=await (0,o.f)(),{data:{user:r}}=await t.auth.getUser();if(!r)return p.NextResponse.json({error:"Unauthorized"},{status:401});let a=await e.json().catch(()=>({})),s=a.email??r.email??"",i=a.username??r.user_metadata?.username??r.email?.split("@")[0]??"player";return await u._.user.findUnique({where:{id:r.id}})?(await u._.user.update({where:{id:r.id},data:{lastLogin:new Date,email:s,username:i}}),p.NextResponse.json({ok:!0,existing:!0})):(await u._.user.create({data:{id:r.id,email:s,username:i,authProvider:r.app_metadata?.provider??"email"}}),p.NextResponse.json({ok:!0}))}let l=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/sync-user/route",pathname:"/api/auth/sync-user",filename:"route",bundlePath:"app/api/auth/sync-user/route"},resolvedPagePath:"/Users/artosetrov/Documents/Cursor AI/BumWars/app/api/auth/sync-user/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:h}=l,x="/api/auth/sync-user/route";function _(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},1035:(e,t,r)=>{r.d(t,{_:()=>s});var a=r(3524);let s=globalThis.prisma??new a.PrismaClient({log:["error"]})},6660:(e,t,r)=>{r.d(t,{f:()=>i});var a=r(7782),s=r(2845);let i=async()=>{let e=await (0,s.cookies)(),t=process.env.NEXT_PUBLIC_SUPABASE_URL,r=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!t||!r)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY");return(0,a.createServerClient)(t,r,{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:a})=>e.set(t,r,a))}catch{}}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[787,833,228],()=>r(7135));module.exports=a})();