"use strict";(()=>{var e={};e.id=492,e.ids=[492],e.modules={3524:e=>{e.exports=require("@prisma/client")},2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7699:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var a={};t.r(a),t.d(a,{POST:()=>c});var s=t(3278),o=t(5002),i=t(4877),n=t(6660),u=t(1035),p=t(1309);async function c(e){let r=await (0,n.f)(),{data:{user:t}}=await r.auth.getUser();if(!t)return p.NextResponse.json({error:"Unauthorized"},{status:401});let a=await e.json().catch(()=>({})),s=a.characterId,o=a.inventoryId;if(!s||!o)return p.NextResponse.json({error:"characterId, inventoryId required"},{status:400});let i=await u._.equipmentInventory.findFirst({where:{id:o,characterId:s},include:{item:!0,character:!0}});if(!i||i.character.userId!==t.id)return p.NextResponse.json({error:"Not found"},{status:404});let c=i.maxDurability-i.durability;if(c<=0)return p.NextResponse.json({error:"Предмет не повреждён"},{status:400});let l=Math.max(1,Math.floor(.1*(i.item.buyPrice??i.item.sellPrice??100)*c/i.maxDurability));return i.character.gold<l?p.NextResponse.json({error:"Недостаточно золота"},{status:400}):(await u._.$transaction([u._.equipmentInventory.update({where:{id:o},data:{durability:i.maxDurability}}),u._.character.update({where:{id:s},data:{gold:i.character.gold-l}})]),p.NextResponse.json({ok:!0,cost:l}))}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/shop/repair/route",pathname:"/api/shop/repair",filename:"route",bundlePath:"app/api/shop/repair/route"},resolvedPagePath:"/Users/artosetrov/Documents/Cursor AI/BumWars/app/api/shop/repair/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:x}=l,m="/api/shop/repair/route";function g(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},1035:(e,r,t)=>{t.d(r,{_:()=>s});var a=t(3524);let s=globalThis.prisma??new a.PrismaClient({log:["error"]})},6660:(e,r,t)=>{t.d(r,{f:()=>o});var a=t(7782),s=t(2845);let o=async()=>{let e=await (0,s.cookies)(),r=process.env.NEXT_PUBLIC_SUPABASE_URL,t=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!r||!t)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY");return(0,a.createServerClient)(r,t,{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:t,options:a})=>e.set(r,t,a))}catch{}}}})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[787,833,228],()=>t(7699));module.exports=a})();